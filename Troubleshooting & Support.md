# 故障排除与支持
API文档包含所有API功能的完整说明。此外，API本身的源代码是自由分发的，并且是深入了解API的工作原理的宝贵资源。如果在查看了这些资源后，仍然对可用的API功能存在疑问，可以向API支持小组寻求帮助。

**重要的是要记住:**   
IB 无法提供编程帮助或就如何编写自定义应用程序提供建议。API组可以查看日志文件，其中包含API应用程序与TWS之间的通信记录，并提供有关API可以提供的内容的详细信息。  

关于开始使用IB系统的一般建议：  
+ **在使用API​​之前，请熟悉TWS中的类似功能：** TWS API只是客户端应用程序和TWS之间的通信通道。每个API函数在TWS中都有一个对应的工具。例如，API中的市场数据报价类型对应于TWS中的监视列表列。可以在API中创建的任何订单都可以首先在TWS中创建，建议这样做。此外，如果信息在TWS中不可用，则在API中将不可用。在通过API使用IB网关之前，建议先熟悉TWS。

+ **充分利用示例API应用程序：** 随API下载一起分发的示例应用程序具有每种可用编程语言中基本上每个API函数的示例。如果相应的示例应用程序中没有出现问题，则表明自定义实现存在问题。

+ **定期升级TWS或IB网关：** TWS和IB网关通常具有增强的新软件版本，并且有时可能会修复错误。因此，我们强烈建议用户使他们的软件保持最新。保留API版本并升级TWS没问题，因为TWS / IB网关被设计为与旧API版本向后兼容。如果您遇到的是TWS或IB网关中发生的特定问题，而不是API程序中发生的问题，则很可能在最新的软件版本中不会发生。

## 日志文件
日志文件对于提供有关自定义应用程序可能出现故障的详细信息至关重要。它们是API应用程序程序员直接检查的有用工具，此外，它们可以由API支持小组上载以进行检查。

### API日志
可以将TWS和IB网关配置为创建一个单独的日志文件，其中仅记录与API应用程序之间的通信记录。默认情况下，此日志未启用。但需要通过“全局配置”设置“创建API消息日志文件”来启用（如下图所示）。
+ API日志包含API应用程序和TWS / IB网关之间交换的消息的记录。由于仅记录API消息，因此API日志更紧凑，更易于处理。但是，它们不包含有关TWS / IBG的常规诊断信息，因为它们是TWS / IBG日志。TWS / IBG设置文件夹默认为C：\ Jts（在Mac / Linux上为IBJts）。API日志名为api。[clientId]。[day] .log，其中[clientId]对应于客户端应用程序用于连接到TWS的ID，而[day]对应于工作日（即api.123.Thu。日志）。
+ 还有一个设置“在API日志中包括市场数据”，它将在API日志文件中包括流式市场数据值。历史烛台数据始终记录在API日志中。

**注意：** 在TWS Build 977中，API和TWS日志都是本地加密的。可以从关联的TWS或IB网关会话中解密API日志以供查看，就像TWS日志一样，如描述日志的本地位置的部分所示。

### 启用API日志的创建
交易平台：
+ 导航到文件/编辑→全局配置→API→设置
+ 选中创建API消息日志文件框
+ 单击“应用”，然后单击“确定”。

![avatar](https://interactivebrokers.github.io/tws-api/enable_api_log.png)    

IB网关：
+ 导航到配置→设置→API→设置
+ 选中创建API消息日志文件框
+ 单击“应用”，然后单击“确定”。

### 交易平台日志文件
TWS日志记录级别必须设置为“详细信息”级别，以记录与API相关的信息。默认情况下，它处于“错误”级别，它记录最少的诊断信息。要捕获API消息，必须将日志记录级别更改为“详细信息”。请注意，“日志记录级别”与所有TWS / IBG设置一样，是分别为不同的用户以及TWS和IBG保存的。

+ **重要提示：** 发生问题之前，必须将TWS / IB网关日志文件设置设置为“详细信息”级别，以便在信息显现时正确记录信息。但是，由于在此级别下将生成大量信息，因此生成的日志的大小可能会大大增加。因此，建议仅在进行故障排除和/或跟踪非常具体的问题时使用“详细信息”级别。也可以使用IBApi.EClient.setServerLogLevel函数从API客户端本身完成此操作。一些第三方应用程序（例如NinjaTrader）被配置为在每次连接时调用此功能以设置TWS日志记录级别，因此将TWS日志设置为“详细信息”必须在API客户端程序中完成。

#### 将“ TWS日志记录级别”设置为“详细信息”的步骤
交易平台：
+ 导航到文件/编辑→全局配置→API→设置
+ 将日志记录级别设置为详细信息

![avatar](https://interactivebrokers.github.io/tws-api/logging_detail.png)

IB网关:  
+ 导航到配置→设置→API→设置
+ 将日志记录级别设置为详细信息

## 日志的本地位置
日志默认存储在Windows计算机上的TWS设置目录下的C：\ Jts \中（默认值可以在登录屏幕上进行不同配置）。  
可以使用Ctrl-Alt-U组合从TWS或IB网关会话中找到日志文件目录的路径。这将显示路径，例如C：\ Jts \ detcfsvirl \（在Windows上）。
  
**根据隐私权法规，日志在保存到磁盘之前已加密。可以从关联的TWS或IB网关会话中解密它们。**  
在交易平台中：经典交易平台->帐户->诊断->交易平台日志。在IB网关中，选择文件->网关日志。

## 上传日志
+ 如果在发生问题期间使用设置“创建API消息日志”启用了API日志记录，则可以使用Ctrl-Alt-Q组合将其上传到API组，然后单击Submit。如果日志已上传，请通过在帐户管理（位于“支持”下）的消息中心中创建一个Webticket（指示相关TWS会话的用户名）来通知API支持小组。在某些情况下，也可能会在详细日志记录级别请求TWS日志。TWS日志可能会变得很大，并且可能无法通过自动方法上载；在这种情况下，可以找到另一种上载方式。