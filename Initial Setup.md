# 初始化
TWS API是IB独立交易应用程序，TWS和IB网关的接口。这些都是基于Java的独立交易应用程序，这些应用程序旨在要求使用图形用户界面来进行安全的用户身份验证。因此，不支持没有GUI的任何应用程序的“无头”操作。

## 交易者工作站
我们由做市商设计的IB交易者工作站（TWS），使交易者，投资者和机构可以通过一个账户在全球100多个市场上交易股票，期权，期货，外汇，债券和基金。  
**TWS API是TWS的编程接口，因此，要使应用程序连接到API，必须首先有一个正在运行的TWS或IB网关实例。**  
要使用API​​的9.72+版本，必须具有TWS 952或更高版本。

## IB网关
作为API用户的TWS的替代产品，IB还提供IB网关（IBGW）。  
从API应用程序的角度来看，IB网关和TWS是相同的。两者都代表用户认证后API客户端应用程序可以打开套接字连接的服务器。  
无论使用哪种应用程序（TWS或IBGW），用户都必须在登录窗口中手动输入其用户名和密码。出于安全原因，不支持没有GUI的TWS或IBGW的无头会话。  
从用户的角度来看，IB网关可能是有利的，因为它是一种较轻的应用程序，消耗的资源少40％。IB网关仅以“离线”版本提供，类似于“离线TWS”，不会自动更新。

TWS和IBGW均设计为每天重启。在更改合同或添加新合同的情况下，执行诸如重新下载合同定义之类的功能是必要的。从974+版本开始，两个应用程序都提供了自动重新启动功能，该功能允许应用程序每天重新启动而无需用户干预。启用此选项后，TWS或IBGW可能会在周日至周日运行而无需重新进行身份验证。在星期六晚上每晚服务器重置后，有必要再次输入安全凭证。

与IBGW相比，TWS的优势在于，它为最终用户提供了许多工具（风险导航器，OptionTrader，BookTrader等）和图形用户界面，可用于监视帐户或下订单。对于初次使用API​​的用户，建议在使用IBGW之前先熟悉TWS。

为简单起见，本指南将主要参考TWS，尽管读者应了解，出于TWS API的目的，TWS和IB网关是同义词。

## 登录多个应用程序
不能使用相同的用户名同时登录多个交易应用程序。但是，可以创建一个帐户的其他用户名，同时可以在不同的交易应用程序中使用，只要一次使用给定的用户名登录的交易应用程序不超过一个即可。  
在某些其他情况下，创建其他用户名也很有用：
+ 如果TWS或IBGW使用用于在该会话期间登录到Client Portal的用户名登录，则该应用程序在下一次断开连接（例如重置服务器）后将无法自动重新连接到服务器。
+ 如果TWS或IBGW会话正在共享来自用于登录客户门户网站的实时用户的数据，则登录到纸交易帐户的TWS或IBGW会话将不会接收市场数据。

如果在上述两种情况中的任何一种情况下都使用不同的用户名登录Client Portal，则不会影响TWS / IBGW会话。

[如何在帐户管理中添加其他用户名](https://www.interactivebrokers.com/en/software/am3/am.htm#am/settings/addingusernamestoauser.htm)
+ 重要的是要注意，市场数据订阅是为每个实时用户名独立设置的。

## 启用API连接
在任何客户端应用程序可以连接到Trader Workstation之前，需要将TWS配置为侦听特定端口上的传入API连接。默认情况下，首次安装TWS时，它将不允许API连接。相比之下，IBGW默认情况下接受基于套接字的API连接。要在TWS中启用API访问，请在“编辑”->“全局配置”->“ API”->“设置”中导航到TWS的API设置，并确保激活了“启用ActiveX和套接字客户端”选项，如下所示：

![avatar](https://interactivebrokers.github.io/tws-api/enable_socket.png)  

还要提及的重要一点是“套接字端口”。  

**默认情况下，将为套接字端口7496设置生产帐户TWS会话，而模拟帐户会话将在套接字端口7497上进行侦听。** 

但是，这些只是默认值，因为它们几乎始终在任何计算机上都可用。只要在API客户端和TWS设置中指定的套接字端口匹配，就可以将它们更改为任何打开的套接字端口。如果一台计算机上有多个TWS会话，则使用套接字端口来区分TWS会话。由于一次只能有一个应用程序可以监听一个端口，因此您需要为每个运行的TWS分配不同的端口。

**重要：在同一台计算机上运行模拟和实时TWS时，请确保您的客户端应用程序连接到正确的TWS！**

## 只读API
“API设置”对话框允许您配置TWS以使用“只读”设置记录接受的API订单。默认情况下，启用“只读”作为其他预防措施。启用只读模式后，有关订单的信息不适用于API。  

## 主客户ID
默认情况下，“主客户端ID”字段未设置。要指定某个客户应自动接收所有未结订单的更新以及所有客户下达的委托报告，应在TWS或IBGW全局配置中将该客户的ID设置为主客户ID。从API客户端应用程序在对IBApi :: EClientSocket :: eConnect的初始函数调用中指定了clientID 。

## 安装API源
该API本身可以从以下位置下载和安装：  
[http://interactivebrokers.github.io/](http://interactivebrokers.github.io/)  

许多第三方应用程序已经具有自己的API版本，该API版本是在安装第三方应用程序的过程中安装的。如果使用第三方产品，则应首先验证是否必须单独安装API以及需要什么版本的API-许多第三方产品仅与特定的API版本兼容。

运行Windows版本的API安装程序会为API源代码创建目录“ C：\\ TWS API \”，此外还会自动将两个文件复制到DDE和C ++ API的Windows目录中。将API安装到C：驱动器很重要，否则API应用程序可能无法找到关联的文件。  
Windows安装程序还会复制ActiveX控件TWSLib.dll，C＃API CSharpAPI.dll和C ++ API TwsSocketClient.dll的编译的动态链接库（DLL）。从API版本973.07开始，运行API安装程序旨在安装与32位和64位应用程序兼容的ActiveX控件TWSLib.dll和TwsRTDServer控件TwsRTDServer.dll。

## 更改已安装的API版本

（仅在Windows上）
如果需要与系统上当前安装的版本不同的ActiveX版本（v9.71或更低版本）或C ++ API，则需要执行其他步骤来卸载以前的API版本，以手动删除名为“ TwsSocketClient.dll”的文件。 
1. 照常从Windows控制面板中的“添加/删除工具”中卸载API
2. 如果仍然剩余任何文件以防止版本不匹配，请删除C：\ TWS API \文件夹。
3. 找到文件“ C：\ Windows \ SysWOW64 \ TwsSocketClient.dll”。删除该文件。
4. 在安装其他API版本之前，请重新启动计算机。